<!-- This template now supports admin features -->
<div id="config-area">
    <div class="bg-white rounded-lg shadow mb-6">
        <div class="border-b border-gray-200 px-6 py-4">
            <h3 class="text-lg font-medium">Configuration Settings</h3>
        </div>
        <div class="p-6">
            <div class="space-y-6">
                <div>
                    <h4 class="text-md font-medium mb-2">Network Settings</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h5 class="text-sm font-medium text-gray-700">Network URL</h5>
                                <p class="text-gray-500 text-sm">{{.Config.NetworkURL}}</p>
                            </div>
                            <div class="text-xs px-3 py-1 rounded-full
                                {{if eq .Config.NetworkURL "https://api.mainnet-beta.solana.com"}}
                                bg-green-100 text-green-800
                                {{else if eq .Config.NetworkURL "https://api.devnet.solana.com"}}
                                bg-yellow-100 text-yellow-800
                                {{else if eq .Config.NetworkURL "https://api.testnet.solana.com"}}
                                bg-purple-100 text-purple-800
                                {{else}}
                                bg-blue-100 text-blue-800
                                {{end}}
                            ">
                                {{if eq .Config.NetworkURL "https://api.mainnet-beta.solana.com"}}
                                Mainnet
                                {{else if eq .Config.NetworkURL "https://api.devnet.solana.com"}}
                                Devnet
                                {{else if eq .Config.NetworkURL "https://api.testnet.solana.com"}}
                                Testnet
                                {{else}}
                                Custom
                                {{end}}
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-md font-medium mb-2">Scan Settings</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <div>
                                <h5 class="text-sm font-medium text-gray-700">Scan Interval</h5>
                                <p class="text-gray-500 text-sm">{{.Config.ScanInterval}}</p>
                            </div>
                        </div>

                        <div class="pt-3 border-t border-gray-200">
                            <h5 class="text-sm font-medium text-gray-700 mb-2">Global Scan Mode</h5>
                            <div class="flex items-center">
                                <p class="text-gray-500 text-sm mr-2">{{.Config.Scan.ScanMode}}</p>
                                <span class="text-xs px-3 py-1 rounded-full
                                    {{if eq .Config.Scan.ScanMode "all"}}
                                    bg-green-100 text-green-800
                                    {{else if eq .Config.Scan.ScanMode "whitelist"}}
                                    bg-blue-100 text-blue-800
                                    {{else if eq .Config.Scan.ScanMode "blacklist"}}
                                    bg-yellow-100 text-yellow-800
                                    {{else}}
                                    bg-gray-100 text-gray-800
                                    {{end}}
                                ">
                                    {{if eq .Config.Scan.ScanMode "all"}}
                                    All Tokens
                                    {{else if eq .Config.Scan.ScanMode "whitelist"}}
                                    Whitelist
                                    {{else if eq .Config.Scan.ScanMode "blacklist"}}
                                    Blacklist
                                    {{else}}
                                    Custom
                                    {{end}}
                                </span>
                            </div>
                        </div>

                        {{if or (eq .Config.Scan.ScanMode "whitelist") (gt (len .Config.Scan.IncludeTokens) 0)}}
                        <div class="mt-3">
                            <h5 class="text-sm font-medium text-gray-700 mb-1">Included Tokens</h5>
                            <div class="space-y-2 max-h-40 overflow-y-auto">
                                {{if gt (len .Config.Scan.IncludeTokens) 0}}
                                    {{range .Config.Scan.IncludeTokens}}
                                    <div class="flex items-center justify-between bg-white p-2 rounded border border-gray-200">
                                        <p class="text-sm font-mono">{{.}}</p>
                                        <a href="https://explorer.solana.com/address/{{.}}" target="_blank" class="text-indigo-600 hover:text-indigo-900">
                                            <i class="fas fa-external-link-alt"></i>
                                        </a>
                                    </div>
                                    {{end}}
                                {{else}}
                                <p class="text-gray-500 text-sm italic">No tokens specified</p>
                                {{end}}
                            </div>
                        </div>
                        {{end}}

                        {{if or (eq .Config.Scan.ScanMode "blacklist") (gt (len .Config.Scan.ExcludeTokens) 0)}}
                        <div class="mt-3">
                            <h5 class="text-sm font-medium text-gray-700 mb-1">Excluded Tokens</h5>
                            <div class="space-y-2 max-h-40 overflow-y-auto">
                                {{if gt (len .Config.Scan.ExcludeTokens) 0}}
                                    {{range .Config.Scan.ExcludeTokens}}
                                    <div class="flex items-center justify-between bg-white p-2 rounded border border-gray-200">
                                        <p class="text-sm font-mono">{{.}}</p>
                                        <a href="https://explorer.solana.com/address/{{.}}" target="_blank" class="text-indigo-600 hover:text-indigo-900">
                                            <i class="fas fa-external-link-alt"></i>
                                        </a>
                                    </div>
                                    {{end}}
                                {{else}}
                                <p class="text-gray-500 text-sm italic">No tokens specified</p>
                                {{end}}
                            </div>
                        </div>
                        {{end}}
                    </div>
                </div>

                <div>
                    <h4 class="text-md font-medium mb-2">Alert Settings</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="text-sm font-medium text-gray-700">Minimum Balance</h5>
                            <p class="text-gray-500 text-sm">{{.Config.Alerts.MinimumBalance}}</p>
                        </div>

                        <div class="bg-gray-50 rounded-lg p-4">
                            <h5 class="text-sm font-medium text-gray-700">Significant Change</h5>
                            <p class="text-gray-500 text-sm">{{printf "%.0f%%" (mul .Config.Alerts.SignificantChange 100)}}%</p>
                        </div>
                    </div>
                </div>

                <div>
                    <h4 class="text-md font-medium mb-2">Notification Settings</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h5 class="text-sm font-medium text-gray-700">Discord Notifications</h5>
                                <p class="text-gray-500 text-sm">
                                    {{if .Config.Discord.Enabled}}
                                    Enabled
                                    {{else}}
                                    Disabled
                                    {{end}}
                                </p>
                            </div>
                            <div class="text-xs px-3 py-1 rounded-full
                                {{if .Config.Discord.Enabled}}
                                bg-green-100 text-green-800
                                {{else}}
                                bg-gray-100 text-gray-800
                                {{end}}
                            ">
                                {{if .Config.Discord.Enabled}}
                                Active
                                {{else}}
                                Inactive
                                {{end}}
                            </div>
                        </div>

                        {{if .Config.Discord.Enabled}}
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <h5 class="text-sm font-medium text-gray-700 mb-1">Webhook URL</h5>
                            <p class="text-gray-500 text-sm break-all">
                                {{.Config.Discord.WebhookURL}}
                            </p>
                        </div>

                        <div class="mt-3">
                            <h5 class="text-sm font-medium text-gray-700 mb-1">Channel ID</h5>
                            <p class="text-gray-500 text-sm">
                                {{.Config.Discord.ChannelID}}
                            </p>
                        </div>
                        {{end}}
                    </div>
                </div>

                <div>
                    <h4 class="text-md font-medium mb-2">Monitored Wallets</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-2 flex justify-between items-center">
                            <h5 class="text-sm font-medium text-gray-700">Wallet Addresses</h5>
                            <span class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full">{{len .Config.Wallets}} wallets</span>
                        </div>
                        <div class="space-y-3 max-h-60 overflow-y-auto">
                            {{range .Config.Wallets}}
                            <div class="flex items-center justify-between bg-white p-2 rounded border border-gray-200">
                                <p class="text-sm font-mono">{{.}}</p>
                                <div class="flex space-x-2">
                                    <a href="/wallets/{{.}}" class="text-indigo-600 hover:text-indigo-900">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="https://explorer.solana.com/address/{{.}}" target="_blank" class="text-indigo-600 hover:text-indigo-900">
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            </div>
                            {{end}}
                        </div>
                    </div>
                </div>

                {{if .Config.WalletConfigs}}
                <div>
                    <h4 class="text-md font-medium mb-2">Wallet-Specific Configurations</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-2 flex justify-between items-center">
                            <h5 class="text-sm font-medium text-gray-700">Custom Wallet Settings</h5>
                            <span class="text-xs bg-purple-100 text-purple-800 px-3 py-1 rounded-full">{{len .Config.WalletConfigs}} custom configs</span>
                        </div>

                        <div class="space-y-4 max-h-80 overflow-y-auto">
                            {{range $wallet, $config := .Config.WalletConfigs}}
                            <div class="bg-white p-3 rounded border border-gray-200">
                                <div class="flex justify-between items-center mb-2">
                                    <p class="text-sm font-medium font-mono">{{$wallet}}</p>
                                    <a href="/wallets/{{$wallet}}" class="text-indigo-600 hover:text-indigo-900">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>

                                {{if $config.Scan}}
                                <div class="ml-2 border-l-2 border-indigo-200 pl-3">
                                    <div class="mb-2">
                                        <span class="text-xs font-medium text-gray-700">Scan Mode:</span>
                                        <span class="text-xs px-2 py-0.5 ml-1 rounded-full
                                            {{if eq $config.Scan.ScanMode "all"}}
                                            bg-green-100 text-green-800
                                            {{else if eq $config.Scan.ScanMode "whitelist"}}
                                            bg-blue-100 text-blue-800
                                            {{else if eq $config.Scan.ScanMode "blacklist"}}
                                            bg-yellow-100 text-yellow-800
                                            {{else}}
                                            bg-gray-100 text-gray-800
                                            {{end}}
                                        ">
                                            {{$config.Scan.ScanMode}}
                                        </span>
                                    </div>

                                    {{if and $config.Scan.IncludeTokens (gt (len $config.Scan.IncludeTokens) 0)}}
                                    <div class="mb-2">
                                        <span class="text-xs font-medium text-gray-700">Include Tokens:</span>
                                        <div class="mt-1 space-y-1">
                                            {{range $config.Scan.IncludeTokens}}
                                            <div class="flex items-center text-xs">
                                                <span class="font-mono">{{.}}</span>
                                            </div>
                                            {{end}}
                                        </div>
                                    </div>
                                    {{end}}

                                    {{if and $config.Scan.ExcludeTokens (gt (len $config.Scan.ExcludeTokens) 0)}}
                                    <div>
                                        <span class="text-xs font-medium text-gray-700">Exclude Tokens:</span>
                                        <div class="mt-1 space-y-1">
                                            {{range $config.Scan.ExcludeTokens}}
                                            <div class="flex items-center text-xs">
                                                <span class="font-mono">{{.}}</span>
                                            </div>
                                            {{end}}
                                        </div>
                                    </div>
                                    {{end}}
                                </div>
                                {{end}}
                            </div>
                            {{end}}
                        </div>
                    </div>
                </div>
                {{end}}

                <div>
                    <h4 class="text-md font-medium mb-2">Ignored Tokens</h4>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="mb-2 flex justify-between items-center">
                            <h5 class="text-sm font-medium text-gray-700">Token Addresses</h5>
                            <span class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full">{{len .Config.Alerts.IgnoreTokens}} tokens</span>
                        </div>

                        {{if len .Config.Alerts.IgnoreTokens}}
                        <div class="space-y-3 max-h-40 overflow-y-auto">
                            {{range .Config.Alerts.IgnoreTokens}}
                            <div class="flex items-center justify-between bg-white p-2 rounded border border-gray-200">
                                <p class="text-sm font-mono">{{.}}</p>
                                <a href="https://explorer.solana.com/address/{{.}}" target="_blank" class="text-indigo-600 hover:text-indigo-900">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                            </div>
                            {{end}}
                        </div>
                        {{else}}
                        <p class="text-gray-500 text-sm italic">No tokens are being ignored</p>
                        {{end}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="bg-white rounded-lg shadow">
    <div class="border-b border-gray-200 px-6 py-4">
        <h3 class="text-lg font-medium">Update Configuration</h3>
    </div>
    <div class="p-6">
        <p class="mb-4 text-gray-600">To update your configuration, edit the <code class="bg-gray-100 px-2 py-1 rounded">config.json</code> file and restart the monitor, or use the admin interface to make changes.</p>

        <pre class="bg-gray-800 text-gray-200 p-4 rounded-lg overflow-x-auto whitespace-pre">
{
    "network_url": "{{.Config.NetworkURL}}",
    "wallets": [
{{range $index, $wallet := .Config.Wallets}}        "{{$wallet}}"{{if lt $index (sub (len $.Config.Wallets) 1)}},{{end}}
{{end}}    ],
    "scan_interval": "{{.Config.ScanInterval}}",
    "alerts": {
        "minimum_balance": {{.Config.Alerts.MinimumBalance}},
        "significant_change": {{.Config.Alerts.SignificantChange}},
        "ignore_tokens": [
{{range $index, $token := .Config.Alerts.IgnoreTokens}}            "{{$token}}"{{if lt $index (sub (len $.Config.Alerts.IgnoreTokens) 1)}},{{end}}
{{end}}        ]
    },
    "discord": {
        "enabled": {{.Config.Discord.Enabled}},
        "webhook_url": "{{.Config.Discord.WebhookURL}}",
        "channel_id": "{{.Config.Discord.ChannelID}}"
    },
    "scan": {
        "scan_mode": "{{.Config.Scan.ScanMode}}",
        "include_tokens": [
{{range $index, $token := .Config.Scan.IncludeTokens}}            "{{$token}}"{{if lt $index (sub (len $.Config.Scan.IncludeTokens) 1)}},{{end}}
{{end}}        ],
        "exclude_tokens": [
{{range $index, $token := .Config.Scan.ExcludeTokens}}            "{{$token}}"{{if lt $index (sub (len $.Config.Scan.ExcludeTokens) 1)}},{{end}}
{{end}}        ]
    }{{if .Config.WalletConfigs}},
    "wallet_configs": {
{{range $wallet, $config := .Config.WalletConfigs}}        "{{$wallet}}": {
            "scan": {
                "scan_mode": "{{$config.Scan.ScanMode}}",
                "include_tokens": [
{{range $index, $token := $config.Scan.IncludeTokens}}                    "{{$token}}"{{if lt $index (sub (len $config.Scan.IncludeTokens) 1)}},{{end}}
{{end}}                ],
                "exclude_tokens": [
{{range $index, $token := $config.Scan.ExcludeTokens}}                    "{{$token}}"{{if lt $index (sub (len $config.Scan.ExcludeTokens) 1)}},{{end}}
{{end}}                ]
            }
        }{{if not (isLastKey $.Config.WalletConfigs $wallet)}},{{end}}
{{end}}    }{{end}}
}
</pre>
    </div>
</div>

<script src="/static/js/config.js"></script>

{{define "mul"}}
  {{printf "%.2f" (mul . .)}}
{{end}}

{{define "sub"}}
  {{sub . .}}
{{end}}

{{define "isLastKey"}}
  {{eq (lastKey .) .}}
{{end}}

{{define "lastKey"}}
  {{$last := ""}}
  {{range $k, $v := .}}
    {{$last = $k}}
  {{end}}
  {{$last}}
{{end}}
